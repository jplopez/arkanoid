pico-8 cartridge // http://www.pico-8.com
version 42
__lua__

#include globals.lua

-- Core functions and utilities
#include core/class.lua
#include core/log.lua
#include core/collision_engine.lua
#include core/state_machine.lua
#include core/game_states.lua
#include core/utils/timers.lua
#include core/utils/utils.lua

#include sprites/tiny_numbers.lua

-- Entities
#include entities/paddle.lua
#include entities/ball.lua
#include entities/brick.lua
#include entities/level.lua

-- Levels
#include entities/levels/level_def.lua
#include entities/levels/level_parser.lua

-- Game States
#include states/init.lua
#include states/start.lua
#include states/game.lua
#include states/gameover.lua
#include states/levelup.lua
#include states/bonus.lua



-- collision handlers
#include collisions/paddle_collision_handler.lua
#include collisions/ball_collision_handler.lua
#include collisions/brick_collision_handler.lua


-------------
--game loop
-------------

function _init()
  cls()
  init_gamestates()
  init_players()
  init_objects()
  
  --start screen state
  set_gamestate("start")

  log("INI gamestate=".._gamestates["current"])
end

-- called every frame
function _update60()
  log("UPD gamestate=".._gamestates["current"])
  local gamestate = current_gamestate()
  if(gamestate != nil) gamestate:update()
end

-- called every frame
function _draw()
  log("DRW gamestate=".._gamestates["current"])
  local gamestate = current_gamestate()
  if(gamestate != nil) gamestate:draw()
end


__gfx__
00000000077007700000000000000000000000000700070007000500050005000ddddd000ddddd000ddddd000ddddd000ddddd000ddddd000ddddd000ddddd00
088008e0788778e7000000000000000077777777776077607760555055505550d60606d0d61666d0d6ccc6d0d66866d0d6aa06d0d66866d0d66966d0d66666d0
0e8888807e888887000000000000000077777777060006000600050005000500d08080d0d61666d0d6c666d0d68986d0d660a0d0d68986d0d69a96d0d66a66d0
0e8888807e888887000000000000000077777777000000000000000000000000d08880d0d61666d0d66cc6d0d89a98d0d60aa0d0d89a98d0d9a7a9d0d6a7a6d0
00e8880007e88870000000000000000077777777000000000000000000000000d60806d0d61116d0d6ccc6d0d68986d0d660a0d0d9a6a9d0da767ad0da767ad0
0008800000788700000000000000000077777777000000000000000000000000d66066d0d66666d0d66666d0d66866d0d6aa06d0da666ad0d76667d0d76667d0
00000000000770000000000000000000000000000000000000000000000000000ddddd000ddddd000ddddd000ddddd000ddddd000ddddd000ddddd000ddddd00
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
077700000aaa00000888000000999000000000000000000000000000000000000ddddd000ddddd000ddddd000ddddd0000000000000000000000000000000000
76777000a9aaa0008d8880000a99f8009aaaaaa98eeeeee83bbbbbb3c666666cd66966d0d66166d0d63336d0d66866d000000000000000000000000000000000
77777000aaaaa000888880009aa98f90a9999994e8888882b33333356cccccc1d69a96d0d61316d0d63666d0d68986d000000000000000000000000000000000
77776000aaaa90008888d000999f8990a9999994e8888882b33333356cccccc1d69a96d0d13131d0d63636d0d89a98d000000000000000000000000000000000
077600000aa90000088d00009f889aa0a9999994e8888882b33333356cccccc1d69a96d0d61316d0d63336d0d8aa98d000000000000000000000000000000000
000000000000000000000000088faa00944444498222222835555553c111111cd66966d0d66166d0d66666d0d68886d000000000000000000000000000000000
0000000000000000000000000089a000000000000000000000000000000000000ddddd000ddddd000ddddd000ddddd0000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00666100aa0a00a0a0aa0a0a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06776610a0a0aaa0a00aa0aa00000000effffffe67777776a777777a566666657077777070077770000777700000777000000770000000000000000000000000
677776d1aaaaaaa0aa0aa0aa00000000feeeeee2766666657aaaaaa96555555d7707770777007700700077007000070070000000000000000000000000000000
67777dd1aa00a0a0aa0aa0a000000000feeeeee2766666657aaaaaa96555555d7770070777700707770000007000000000000000000000000000000000000000
66776d51aaaa00a0aa0a0a0a00000000feeeeee2766666657aaaaaa96555555d7777707777777007777700077700000070000000000000000000000000000000
6666d551000000000000000000000000e222222e65555556a999999a5dddddd57777077777770077777700777770007770700007000000000000000000000000
06dd5510000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
015555110666666600993bb07777d007771000777100577700000000000000000000000000000000000000000000000000000000000000000000000000000000
11422442663363c3029333b0777d0007771000777100057700000000000000007777077777770077777700777770007770700007000000000000000000000000
144444446c3cc6cc2449333b77d00007771000777100007700000000000000007777707777777007777700077700000070000000000000000000000000000000
5444444463ccccc34449333377100007771000777100007700000000000000007770070777700707770000007000000000000000000000000000000000000000
5dd1ddd163cccc3c449333b377100007771000777100007700000000000000007707770777007700700077007000070070000000000000000000000000000000
524144446c3ccccc243333b377100007771000777100007700000000000000007077777070077770000777700000777000000770000000000000000000000000
144d442463cccccc0299333b77d100077710007771000d7700000000000000000000000000000000000000000000000000000000000000000000000000000000
144d444463cccccc004933b0777d1007771000777100d77700000000000000000000000000000000000000000000000000000000000000000000000000000000
1d11dddd636ccccc0022333b00000000000000001181100000000000000000000000000000000000000000000000000000000000000000000000000011111111
1244444d66c3cccc0293333b0000555000555500197f100000000000000000000000000000000000000000000000000000000000000000000000000011111111
5444444d633ccccc244933330055333000bbb300a777e00000000000000000007777770707777007077700000077000000070000000000000000000011111111
5244444d6cccccc34449333b0053bbb000bbb3001b7d100000000000000000000700707700000077000000070000000000000000000000000000000075111111
5ddddd116c6ccc3c449333bb0053bbb000bbb30011c11000000000000000000070770777700707777000077700000077000000070000000000000000d2211111
124d4424663ccccc443333bb0055333000b333000000000000000000000000007707777777077777770077777000077770000077000000000000000002811111
144d444263cccccc0299333300005550005555000000000000000000000000000000000000000000000000000000000000000000000000000000000000081111
544d44446ccccccc0292333b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000022111
1dddddd163cccccc0493333b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008211
1244444d6cc3cccc0449333300005550005555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000281
1244444d636ccccc244933330055999000aaa9000000000000000000000000007777770707777007077700000077000000070000000000000000000000000281
0444444d66ccccc32449333b0059aaa000aaa9000000000000000000000000000700707700000077000000070000000000000000000000000000000000000281
51ddddd16ccccc3c049333b00059aaa000aaa9000000000000000000000000007077077770070777700007770000007700000007000000000000000000000281
54414424633cc3cc293333b00055999000a999000000000000000000000000007707777777077777770077777000077770000077000000000000000000000281
5441444466c33c630499333000005550005555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000811
044d4442066666660449333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008211
05511111066666660bbb333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008200000000008111
12444441663363c33333b33b00005550005555000000000000000000000000000000000000000000000000000000000000000000000000008222222222281111
1444444d6c3cc6cc3433333b005522200088820000000000000000000000000000000000000000000000000000000000000000000000000082dddddddd281111
14424441636cccc344493333005288800088820000000000000000000000000000000000000000000000000000000000000000000000000084dddddddde81111
5dddd1dd66cccc3c449923b300528880008882000000000000000000000000000000000000000000000000000000000000000000000000008efffffffe881111
544d4442633cc3cc449333b300552220008222000000000000000000000000000000000000000000000000000000000000000000000000008e77788888811111
144d444466c33c632499333b00005550005555000000000000000000000000000000000000000000000000000000000000000000000000008e77e81111111111
0441424406666666242933b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008e7e811111111111
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008e78111111111111
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008e78111111111111
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008ef1111111111111
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008841111111111111
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008881111111111111
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008211111111111111
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002111111111111111
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111711111111
1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115dd21111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111166082111111
11111111111111178e777761751111577777751111111111111111111d7882111111111177777761111111111d777761111111111d7777777777750002811111
11111111111115de84dddee5d221111edddde21111111111111111115ee8222111111111eddddee1111115d55ddddd522221111114eddddeddddd10002221111
1111111111111d7882000287028111180000821111111111111111117e880281111111118200028111111d777500000888811111128000080000000000081111
1111111111117e808200028000081118000082111111111111111117820800081111111182000281111775000000000000088211128000080000820000008211
111111111115e42082000220000221180000821111211111111111df20080002211111118200028111ddd1000000000000022211128000080000820000002211
11111111111782008200000000008218000082111281111111111d78000800008211111182000281166000000000000000000281128000080000888000000281
111111111df800008200028000000280000082118208111111117e80000800000281111182000281750000000288888000000008128000080000821800000008
111111115ee20000820002820000022000008212200821111115f420000800000222111182000285650000022222222220000008188000080000821e00000008
111111117e80000082000288000000000000821800008211111782000008000000081111820002e7000000088200000882000000888000080000811700000008
1111111782000000820002870000000000008820000082111df800000008000000008211820002e70000028000022222282000008880000800008e6000000281
1111115f80000000820002e60000000000008820000081115de80000000800000000821182000286000002200152d22d248000002880000800008ed000000221
1111167800000000820006600000028000008200000811117e8000000008000000000281820002800000820026727dd726780000028000080000820000008211
11116e80000000008200000000008218000000000281111782000000000800000000002882000280000082022222222222280000028000080000000000081111
1111fe200000000082000000000081180000000002211157820000000028000000000018820002800000821d2222d22d22480000028000280000000000281111
11178222222822228222222222281118222222228211167822222222222822222222222282222882222282d726727dd726782222288222282222222228811111
1d68ddddd488dddd82dddddddd281118dddddddd82116e88ddddd48dddd8ddddd48dddddddddd888ddddd88d2222d22d288ddddd888dddd8dddddddd82111111
1df8ddddd488dddd84ddddddddd81118dddddddd82117e88ddddd48dddd8ddddd88dddddddddd888ddddde8222222222288ddddd888dddd8dddddddd81111111
7e8fffff8218ffff8effffffffff8218fffffffffe87888fffff821fffe8fffffe88fffffffffe88ffffffe88f727d288effffff888fffe8fffffff811111111
8ef777f8111877778e7777777777f48877778f777fee8ef777f8111777f877777e818f7777777e818f77777ffe88e88fff7777f8128777f877777e8111111111
8e7777f8111877778e77777777777e8877778e7777f88e7777f8111777f877777e818e7777777e818e7777777e8888e7777777e8128777f877777e2111111111
02877777821877778e777e88777777f877f8128777778e777777821777f877777e81128777777e81128777777777777777777e81128777f87777821111111111
112e7777f48877778e77e211ef7777f87e82112e777788e77777f44777f877777e81112e77777e81112eef777777777777fee21112877e8877fe211111111111
111877777e8877778e7782118e7777f87e2111187777888777777e8777f877777e81111877777e8111188e777777777777f8821112877e8877f8111111111111
11118e7777f877778ef8111112877e88821111118ef811187777777777f877777e8111118e777e81111112888e7777f88881111112e781187e81111111111111
111124e777f8eeee88421111112ee2282111111124e21111ef777eeeeee8eeeee881111124e7e2111111112224eeee4222111111128e2118e211111111111111
1111128777f88888888111111118821811111111128111118e777e88888888888881111112878211111111111288888111111111128811188211111111111111
111111187e8111118211111111111111111111111111111112878211111111111111111111181111111111111111111111111111128111181111111111111111
11111112e211111121111111111111111111111111111111112e2111111111111111111111121111111111111111111111111111112111121111111111111111
11111111821111111111111111111111111111111111111111181111111111111111111111111111111111111111111111111111111111111111111111111111
__sfx__
4801000019320173201532013320123201032010320103201132015320173201e3201f32000300003000030000300003000030000300003000030000300013000130000300003000030000300003000030000300
000000001002112021140211600117001180311b0311e031230312a0312d031300313103126001250012500131001350013300132001000010000101001020010100100001000010100100001000010000100001
48020000123101331002700293202e3203032014300383003b3003a3003c300073000030000300003000030000300003000030000300003000030000300003000030000300003000030000300003000030000300
000200001954215542135420e54207542005420a5420c5420f5421254215542185421a5421c5421d5421f5422354225542285422b5422e5423054232542345423554236542395423a5423b5423b5423a5423b542
000400001e0501f0501f0501e0501b0501805014050120500f0500d0500905007050040500205001050000500005000050070000c0000e0000c00008000050000400002000020000200002000020000000000000
60020000123101331002700293202e3203032014300383003b3003a3003c300073000030000300003000030000300003000030000300003000030000300003000030000300003000030000300003000030000300
1901000033710377103871039730397300e7000e7000c7000b7003a7003c700077000070000700007000070000700007000070000700007000070000700007000070000700007000070000700007000070000700
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
010200000e3100f310027001a3201d3202a32014300383003b3003a3003c300073000030000300003000030000300003000030000300003000030000300003000030000300003000030000300003000030000300
010200000f31010310027001e320233203032014300383003b3003a3003c300073000030000300003000030000300003000030000300003000030000300003000030000300003000030000300003000030000300
010200001031011310027001c3201e3203332014300383003b3003a3003c300073000030000300003000030000300003000030000300003000030000300003000030000300003000030000300003000030000300
010200001131012310027001d3201f320343503b3003a3003c3000730000300003000030000300003000030000300003000030000300003000030000300003000030000300003000030000300003000000000000
010200001231013310027001e320203203532014300383003b3003a3003c300073000030000300003000030000300003000030000300003000030000300003000030000300003000030000300003000030000300
010200001331014310027001e320213203732014300383003b3003a3003c300073000030000300003000030000300003000030000300003000030000300003000030000300003000030000300003000030000300
0102000014310153100270020320223203932014300383003b3003a3003c300073000030000300003000030000300003000030000300003000030000300003000030000300003000030000300003000030000300
